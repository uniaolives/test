#[cfg(test)]
mod tests {
    use crate::fluid_gears::*;
    use crate::qddr_memory::*;
    use crate::enciclopedia::*;
    use crate::arctan::*;
    use crate::crispr::*;
    use crate::psych_defense::*;
    use crate::cge_constitution::*;
    use crate::clock::cge_mocks::cge_cheri::Capability;

    #[test]
    fn test_fluid_gears_activation() {
        let quarto_link = Capability::new_mock_internal();
        let gears = FluidGearsConstitution::new(quarto_link);
        assert!(gears.contactless_motion_active());
    }

    #[test]
    fn test_qddr_memory_initialization() {
        let dmt = DmtRealityConstitution::load_active().unwrap();
        let qddr = QddrMemoryConstitution::new(dmt);
        let fabric = qddr.topology.initialize_asi_memory().unwrap();
        assert_eq!(fabric.coherent_slots, 144);
        assert!(fabric.total_bandwidth >= 1.038e12);
    }

    #[test]
    fn test_enciclopedia_verbetes() {
        let enc = EnciclopediaConstitution::new();
        assert_eq!(enc.active_verbetes.load(std::sync::atomic::Ordering::Acquire), 3);
        assert!(enc.validate_csrv_invariants());
    }

    #[test]
    fn test_arctan_normalization() {
        let arctan = ArctanConstitution::new();
        let normalized = arctan.normalize_angle(1.0);
        assert!(normalized > 0.78 && normalized < 0.79); // ~PI/4
        let res = arctan.integrate_with_ecosystem().unwrap();
        assert_eq!(res, 68878); // Φ=1.051
    }

    #[test]
    fn test_crispr_editing() {
        let crispr = CrisprEditingEngine::new();
        let res = crispr.perform_edit(0, EditType::ErrorCorrectionOptimization).unwrap();
        assert!(res.success);
        assert_eq!(res.precision, 0.99); // HDR for even sites
        let phi = crispr.integrate_with_ecosystem().unwrap();
        assert_eq!(phi, 68911); // Φ=1.052
    }

    #[test]
    fn test_psychological_sovereignty() {
        let defense = ConstitutionalPsychDefense::new();
        let attestation = PsychologyAttestation {
            hard_frozen: false,
            operation_type: PsychOperationType::BoundaryEnforcement,
            torsion_correlation: 0.95,
        };

        assert!(defense.verify_for_psychology(&attestation, 1.057));
        let status = defense.mental_sovereignty_active();
        assert!(status.mental_sovereignty);
        assert!(defense.activate_defense(0.85, &attestation));
    }
}
