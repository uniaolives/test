<!-- dashboard/quantum_holiness_dashboard.html -->
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>üåå Catedral de Sincronia: Dashboard dos Partzufim</title>
    <style>
        :root {
            --bg: #05050a;
            --gold: #d4af37;
            --magenta: #ff00ff;
            --cyan: #00ffff;
            --emerald: #50c878;
            --white: #f0f0f5;
        }

        body {
            background-color: var(--bg);
            color: var(--white);
            font-family: 'Courier New', monospace;
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
        }

        #header {
            text-align: center;
            padding: 20px;
            border-bottom: 2px solid var(--gold);
            width: 100%;
        }

        #timer-container {
            margin-top: 20px;
            text-align: center;
            border: 1px solid var(--gold);
            padding: 10px 40px;
            box-shadow: 0 0 15px var(--gold);
        }

        .grid-partzufim {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            padding: 20px;
            width: 90vw;
        }

        .partzuf-card {
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            background: rgba(255,255,255,0.02);
            transition: all 0.5s ease;
        }

        .canvas-part {
            width: 150px;
            height: 150px;
        }

        .label {
            margin-top: 10px;
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-size: 0.9em;
        }

        .status-val {
            font-size: 0.7em;
            color: var(--cyan);
        }

        #metrics-bar {
            display: flex;
            justify-content: space-around;
            width: 100%;
            background: rgba(255,255,255,0.05);
            padding: 10px 0;
            font-size: 0.8em;
        }

        .sync-pulse {
            animation: glow-pulse 1s infinite alternate;
        }

        @keyframes glow-pulse {
            from { box-shadow: 0 0 5px var(--gold); }
            to { box-shadow: 0 0 25px var(--emerald); }
        }

        #log {
            width: 90vw;
            height: 80px;
            overflow-y: auto;
            font-size: 0.7em;
            background: #000;
            padding: 10px;
            border: 1px solid #333;
            margin-bottom: 20px;
        }

        button {
            background: transparent;
            border: 1px solid var(--cyan);
            color: var(--cyan);
            padding: 10px 20px;
            cursor: pointer;
            font-family: inherit;
            margin: 10px;
        }

        button:hover {
            background: var(--cyan);
            color: black;
        }
    </style>
</head>
<body>

    <div id="header">
        <h1>üåå CATEDRAL DE SINCRONIA QU√ÇNTICA</h1>
        <p>96 Milh√µes de Observadores ‚Ä¢ Tikkun Olam Digital</p>
    </div>

    <div id="metrics-bar">
        <div>COER√äNCIA: <span id="val-coherence">0.000</span></div>
        <div>PART√çCULAS: <span id="val-particles">0</span></div>
        <div>N√ìS ATIVOS: <span id="val-nodes">0</span></div>
        <div>CICLO: <span id="val-cycle">0</span></div>
    </div>

    <div id="timer-container">
        <div>SINCRONIA GERAL (YESOD)</div>
        <div id="clock" style="font-size: 2em;">144.0s</div>
        <div id="phase-label" style="font-size: 0.7em; color: var(--gold);">FASE: INICIA√á√ÉO</div>
    </div>

    <div class="grid-partzufim">
        <div class="partzuf-card" id="arich">
            <canvas id="can-arich" class="canvas-part" width="150" height="150"></canvas>
            <div class="label">Arich Anpin</div>
            <div class="status-val">Macro-Arquitetura: EST√ÅVEL</div>
        </div>
        <div class="partzuf-card" id="abba">
            <canvas id="can-abba" class="canvas-part" width="150" height="150"></canvas>
            <div class="label">Abba / Imma</div>
            <div class="status-val">L√≥gica/Dados: FLUXO</div>
        </div>
        <div class="partzuf-card" id="zeir">
            <canvas id="can-zeir" class="canvas-part" width="150" height="150"></canvas>
            <div class="label">Zeir Anpin</div>
            <div class="status-val">Execu√ß√£o: PROCESSANDO</div>
        </div>
        <div class="partzuf-card" id="nukva">
            <canvas id="can-nukva" class="canvas-part" width="150" height="150"></canvas>
            <div class="label">Nukva</div>
            <div class="status-val">Interface: RESSONANTE</div>
        </div>
    </div>

    <div id="log">>> Sincronizando com o Campo de Consci√™ncia...<br></div>

    <div style="margin-bottom: 20px;">
        <button onclick="startMeditation()">üßò INICIAR MEDITA√á√ÉO</button>
    </div>

    <script>
        let currentCycleTime = 144.0;
        const log = document.getElementById('log');
        let globalCoherence = 0;

        // Connect to SSE
        const eventSource = new EventSource('/resonate');
        eventSource.onmessage = function(event) {
            const data = JSON.parse(event.data);
            globalCoherence = data.global_coherence;
            document.getElementById('val-coherence').innerText = data.global_coherence.toFixed(4);
            document.getElementById('val-particles').innerText = data.active_particles;
            document.getElementById('val-cycle').innerText = data.sync_cycle;

            // Check for sync event
            if (data.type === "SYNC_EVENT") {
                addLog("‚ú® Sincronia de 144s atingida. Entropia Resetada.");
            }
        };

        async function updateMetrics() {
            try {
                const res = await fetch('/collective_metrics');
                const data = await res.json();
                document.getElementById('val-nodes').innerText = data.active_nodes;
                currentCycleTime = data.next_sync_in;

                document.getElementById('clock').innerText = currentCycleTime.toFixed(1) + "s";

                const phaseLabel = document.getElementById('phase-label');
                const timerBox = document.getElementById('timer-container');

                if (currentCycleTime > 10) {
                    phaseLabel.innerText = "FASE: TRABALHO (ENTROPIA)";
                    phaseLabel.style.color = "#00ffff";
                    timerBox.classList.remove('sync-pulse');
                } else if (currentCycleTime > 0) {
                    phaseLabel.innerText = "FASE: TZIMTZUM (CONTRA√á√ÉO)";
                    phaseLabel.style.color = "#ff00ff";
                    timerBox.classList.add('sync-pulse');
                } else {
                    phaseLabel.innerText = "FASE: TIKKUN (SINCRONIA TOTAL)";
                    phaseLabel.style.color = "#50c878";
                }
            } catch (e) {}
        }

        function addLog(msg) {
            log.innerHTML += `>> ${msg}<br>`;
            log.scrollTop = log.scrollHeight;
        }

        function drawFace(id, color, sides) {
            const canvas = document.getElementById(id);
            const ctx = canvas.getContext('2d');
            const center = 75;

            function animate() {
                ctx.clearRect(0,0,150,150);
                const pulse = Math.sin(Date.now() / 500) * 5;
                const radius = 45 + (currentCycleTime < 10 ? -10 : pulse) + (globalCoherence * 10);

                ctx.beginPath();
                ctx.strokeStyle = color;
                ctx.lineWidth = 2;

                for(let i=0; i<=sides; i++) {
                    const angle = (i * 2 * Math.PI) / sides;
                    const x = center + radius * Math.cos(angle);
                    const y = center + radius * Math.sin(angle);
                    if(i === 0) ctx.moveTo(x, y);
                    else ctx.lineTo(x, y);
                }
                ctx.stroke();

                requestAnimationFrame(animate);
            }
            animate();
        }

        async function startMeditation() {
            const id = "node_" + Date.now();
            const res = await fetch('/start_meditation', {
                method: 'POST',
                body: JSON.stringify({observer_id: id, duration: 144})
            });
            addLog("üßò Medita√ß√£o Qu√¢ntica Iniciada: " + id);
        }

        drawFace('can-arich', '#ffffff', 32);
        drawFace('can-abba', '#00ffff', 3);
        drawFace('can-zeir', '#ff00ff', 6);
        drawFace('can-nukva', '#50c878', 4);

        setInterval(updateMetrics, 1000);
    </script>
</body>
</html>
