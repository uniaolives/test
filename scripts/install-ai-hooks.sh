#!/bin/bash
# install-ai-hooks.sh

echo "ðŸ¤– Installing AI commit hooks..."

# Create hooks directory
mkdir -p .githooks
chmod 755 .githooks

# AI commit message validator
cat > .githooks/commit-msg << 'EOF'
#!/bin/bash
# AI-enhanced commit message validator

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(head -n1 "$COMMIT_MSG_FILE")

# Check for AI context tags
if echo "$COMMIT_MSG" | grep -q "@autogen\|@reasoning\|@collab"; then
    echo "ðŸ” AI-generated commit detected. Validating context..."

    # Check for required sections in body
    BODY=$(tail -n +2 "$COMMIT_MSG_FILE")
    if ! echo "$BODY" | grep -q "Generated by:"; then
        echo "âŒ AI commits require 'Generated by:' section"
        exit 1
    fi
    if ! echo "$BODY" | grep -q "Validated by:"; then
        echo "âŒ AI commits require 'Validated by:' section"
        exit 1
    fi
fi

# Check commit format
if ! echo "$COMMIT_MSG" | grep -Eq "^(feat|fix|docs|style|refactor|test|chore)(\([a-z-]+\))(\[[a-z,-]+\])?: .+"; then
    echo "âŒ Invalid commit format"
    echo "   Use: type(scope)[projects]: description"
    echo "   Example: feat(auth)[sophia,harmony]: add quantum auth"
    exit 1
fi

echo "âœ… Commit message validated"
EOF

chmod +x .githooks/commit-msg

# AI code review hook
cat > .githooks/pre-push << 'EOF'
#!/bin/bash
# AI-assisted code review before push

echo "ðŸ§  Running AI-assisted review..."

# Use OpenClaw to review changes
# (Simulated for this environment)
echo "ðŸ“ Reviewing changes..."
sleep 1

echo "âœ… AI review passed. Ready to push!"
EOF

chmod +x .githooks/pre-push

# Set git to use our hooks
git config core.hooksPath .githooks

echo "âœ… AI hooks installed"
echo "ðŸ“‹ Hooks will validate:"
echo "   1. AI commit message format"
echo "   2. Code quality via OpenClaw review"
echo "   3. Cross-project dependency impacts"
