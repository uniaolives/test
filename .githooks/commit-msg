#!/bin/bash
# AI-enhanced commit message validator with Architectural Integrity checks

COMMIT_MSG_FILE=$1
COMMIT_MSG=$(head -n1 "$COMMIT_MSG_FILE")

# Check for AI context tags
if echo "$COMMIT_MSG" | grep -q "@autogen\|@reasoning\|@collab"; then
    echo "üîç AI-generated commit detected. Validating context..."
    BODY=$(tail -n +2 "$COMMIT_MSG_FILE")
    if ! echo "$BODY" | grep -q "Generated by:"; then
        echo "‚ùå AI commits require 'Generated by:' section"
        exit 1
    fi
    if ! echo "$BODY" | grep -q "Validated by:"; then
        echo "‚ùå AI commits require 'Validated by:' section"
        exit 1
    fi
fi

# Architectural Keyword detection
if echo "$COMMIT_MSG" | grep -qiE "geometry|topological|ontological|resonance"; then
    echo "üåå Architectural change detected. Ensuring structural alignment..."
fi

# Check commit format
if ! echo "$COMMIT_MSG" | grep -Eq "^(feat|fix|docs|style|refactor|test|chore)(\([a-z-]+\))(\[[a-z,-]+\])?: .+"; then
    echo "‚ùå Invalid commit format"
    echo "   Use: type(scope)[projects]: description"
    echo "   Example: feat(auth)[sophia,harmony]: add quantum auth"
    exit 1
fi

echo "‚úÖ Commit message validated"
